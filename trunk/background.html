<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title></title>
  <script type="text/javascript" src="webdatabase-operator.js"></script>
</head>
<body>
<script type="text/javascript">
  var fillForm = new FillForm();
  var shortcut = new Shortcut();
  fillForm.createFillFormTable();
  shortcut.createShortcutTable();

  var shortcutMap = [
      {id: 1, name: 'key_bossKey', shortcut: '18+192', type: true, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 2, name: 'key_saveForm', shortcut: '113', type: false, status: true, operation: 'saveForm', modifiable: 'true', extensionId: ''},
      {id: 3, name: 'key_fillForm', shortcut: '114', type: false, status: true, operation: 'fillForm', modifiable: 'true', extensionId: ''},
      {id: 4, name: 'key_quickVisit1', shortcut: '18+112', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 5, name: 'key_quickVisit2', shortcut: '18+113', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 6, name: 'key_quickVisit3', shortcut: '18+115', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 7, name: 'key_quickVisit4', shortcut: '18+116', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 8, name: 'key_quickVisit5', shortcut: '18+117', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 9, name: 'key_quickVisit6', shortcut: '18+118', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 10, name: 'key_quickVisit7', shortcut: '18+119', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 11, name: 'key_quickVisit8', shortcut: '18+120', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 12, name: 'key_quickVisit9', shortcut: '18+121', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 13, name: 'key_quickVisit10', shortcut: '18+122', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''},
      {id: 14, name: 'key_quickVisit11', shortcut: '18+123', type: false, status: true, operation: '', modifiable: 'true', extensionId: ''}
  ]

  chrome.extension.onRequest.addListener(function(request, sender, response) {
    if (request && request.msg == 'saveForm') {
      var formInfo = JSON.stringify(request.formInfo)
      saveOrUpdateForm(request.url, request.title, formInfo);
    } else if (request.msg == 'deleteForm') {
      fillForm.deleteByUrl(request.url);
    }
  });

  function saveOrUpdateForm(url, title, formInfo) {
    fillForm.selectByUrl(url, function(tx, results) {
      if (results.rows.length > 0) {
        var id = results.rows.item(0).id;
        fillForm.update(formInfo, title, id)
      } else {
        fillForm.save(url, title, formInfo);
      }
    });
  }

  function insertRecord(row) {
    if (shortcutMap.length >= row) {
      var shortcutObj = shortcutMap[row];
      shortcut.selectById(shortcutObj.id, function(tx, results) {
        if (results.rows.length == 0) {
          shortcut.insert(shortcutObj);
          row++;
          insertRecord(row);
        }
      });
    }
  }

  function initShortcutTable() {
    insertRecord(0)
  }

  initShortcutTable();
</script>

</body>
</html>